# Telegram News Bot - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram –±–æ—Ç –Ω–∞ Python –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- **RSS feeds** - —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ RSS –ø–æ—Ç–æ–∫–∏
- **–Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω** - –∫–∞–Ω–∞–ª—ã –î–∑–µ–Ω–∞ —á–µ—Ä–µ–∑ –∏—Ö RSS
- **X/Twitter** - —Ç–≤–∏—Ç—ã —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å Nitter (–æ–±—Ö—ñ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤), –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –Ω–∞ aiogram v3 –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –≤ Telegram

1. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç —Å [@BotFather](https://t.me/botfather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π **—Ç–æ–∫–µ–Ω**

–ü—Ä–∏–º–µ—Ä —Ç–æ–∫–µ–Ω–∞: `123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11`

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install aiogram feedparser aiohttp python-dotenv
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```env
TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
ADMIN_ID=987654321
TELEGRAM_CHANNELS=[-1001234567890, -1009876543210]
```

**–ì–¥–µ –≤–∑—è—Ç—å ID?**
- –õ–∏—á–Ω—ã–π ID: –¥–æ–±–∞–≤—å—Ç–µ [@userinfobot](https://t.me/userinfobot) –≤ –ª–∏—á–Ω—ã–π —á–∞—Ç
- ID –∫–∞–Ω–∞–ª–∞: –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª ‚Üí –≤ —Å–≤–æ–π—Å—Ç–≤–∞—Ö –∫–∞–Ω–∞–ª–∞ –µ–≥–æ ID

### 4. –ó–∞–ø—É—Å–∫

```bash
python news_bot.py
```

## üìù –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|
| `/start` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|
| `/add_source` | –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–æ–≤–æ—Å—Ç–µ–π |
| `/remove_source` | –£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ |
| `/sources` | –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ |
| `/fetch` | –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å |

## üîß –ü—Ä–∏–º–µ—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

### RSS Feed (Habr, Geektimes, –∏ —Ç.–¥.)

```
–ù–∞–∑–≤–∞–Ω–∏–µ: Habr
URL: https://habr.com/ru/rss/all/
–¢–∏–ø: rss
```

–î—Ä—É–≥–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ RSS:
- **Habr**: https://habr.com/ru/rss/all/
- **Geektimes**: https://geektimes.ru/rss/all/
- **Medium**: https://medium.com/feed/@username
- **Dev.to**: https://dev.to/api/articles?username=USER&state=published
- **YouTube Channel**: https://www.youtube.com/feeds/videos.xml?channel_id=CHANNEL_ID

### –Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω

```
–ù–∞–∑–≤–∞–Ω–∏–µ: –î–∑–µ–Ω –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
URL: https://dzen.ru/feed/rss/?channel_name=crypto_news
–¢–∏–ø: zen
```

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å URL –∫–∞–Ω–∞–ª–∞ –î–∑–µ–Ω–∞:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–Ω–∞–ª –î–∑–µ–Ω–∞
2. –í URL –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏: `dzen.ru/`**`s/CHANNEL_NAME`**
3. –ü–æ–¥—Å—Ç–∞–≤—å—Ç–µ –≤ —à–∞–±–ª–æ–Ω: `https://dzen.ru/feed/rss/?channel_name=CHANNEL_NAME`

### X/Twitter (—á–µ—Ä–µ–∑ Nitter)

```
–ù–∞–∑–≤–∞–Ω–∏–µ: –ò–ª–æ–Ω –ú–∞—Å–∫
URL: elonmusk
–¢–∏–ø: twitter
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤: `https://nitter.net/elonmusk/rss`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Nitter:**
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Å—Ç—Ä–∞–Ω–∞—Ö —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π Twitter
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á
- –ü—É–±–ª–∏—á–Ω—ã–µ —Ç–≤–∏—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### –¢–∞–±–ª–∏—Ü–∞ `sources`
```sql
- id (PRIMARY KEY)
- name (UNIQUE) - –ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- url (UNIQUE) - URL/–∞–¥—Ä–µ—Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- type - –¢–∏–ø: rss, zen, twitter
- active - –°—Ç–∞—Ç—É—Å (1 = –∞–∫—Ç–∏–≤–µ–Ω)
- added_at - –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
```

### –¢–∞–±–ª–∏—Ü–∞ `published_news`
```sql
- id (PRIMARY KEY)
- source_id (FOREIGN KEY) - –°—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫
- title - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏
- url (UNIQUE) - URL –Ω–æ–≤–æ—Å—Ç–∏ (–¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏)
- published_at - –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ
- posted_to_tg - –î–∞—Ç–∞ –ø–æ—Å—Ç–∏–Ω–≥–∞ –≤ Telegram
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (Scheduler)

–î–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **APScheduler**:

```bash
pip install apscheduler
```

–î–æ–±–∞–≤—å—Ç–µ –≤ `news_bot.py` –ø–µ—Ä–µ–¥ `asyncio.run(main())`:

```python
from apscheduler.schedulers.asyncio import AsyncIOScheduler

async def main():
    # ... –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ ...
    
    scheduler = AsyncIOScheduler()
    scheduler.add_job(bot.cmd_fetch_news_scheduled, 'interval', minutes=30)
    scheduler.start()
    
    await bot.start_polling()
```

–ò –¥–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥ –≤ –∫–ª–∞—Å—Å `NewsBot`:

```python
async def cmd_fetch_news_scheduled(self):
    """–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π"""
    # ... –ª–æ–≥–∏–∫–∞ –∫–∞–∫ –≤ cmd_fetch_news, –Ω–æ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∏ status —Å–æ–æ–±—â–µ–Ω–∏—è
```

## üê≥ Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

`Dockerfile`:
```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

CMD ["python", "news_bot.py"]
```

`requirements.txt`:
```
aiogram==3.5.0
feedparser==6.0.10
aiohttp==3.9.3
python-dotenv==1.0.1
apscheduler==3.11.0
```

–ó–∞–ø—É—Å–∫:
```bash
docker build -t telegram-news-bot .
docker run --env-file .env telegram-news-bot
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ git
2. –î–æ–±–∞–≤—å—Ç–µ –≤ `.gitignore`:
   ```
   .env
   *.db
   __pycache__/
   ```
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è dev/prod
4. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º ID

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –±–æ–ª–µ–µ —á–µ–º 100 –∫–∞–Ω–∞–ª–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **asyncio.gather()** –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
2. –î–æ–±–∞–≤–∏—Ç—å **rate limiting** –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ API
3. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ **Redis** –¥–ª—è –∫—ç—à–∞ –≤–º–µ—Å—Ç–æ –ø–∞–º—è—Ç–∏
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **PostgreSQL** –≤–º–µ—Å—Ç–æ SQLite

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

| –û—à–∏–±–∫–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|
| `TELEGRAM_BOT_TOKEN not set` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª, –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ |
| `Unauthorized` –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä |
| `Chat not found` | –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ ID –∫–∞–Ω–∞–ª–∞ –≤–µ—Ä–Ω—ã–π (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ) |
| `Feed parsing failed` | URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| `Malformed XML` (warning) | –ù–æ—Ä–º–∞–ª—å–Ω–æ, feedparser —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —Ç–∞–∫–∏–º–∏ feeds |

## üí° –°–æ–≤–µ—Ç—ã

- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å RSS –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–∞ [validator.w3.org](https://validator.w3.org/feed/)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/fetch` –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–ª—è –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–º–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É fetch –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [aiogram –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.aiogram.dev/)
- [feedparser –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://feedparser.readthedocs.io/)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Nitter instances](https://github.com/zedeus/nitter/wiki/Instances)
